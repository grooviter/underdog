plugins {
    id('groovy')
    id('org.kordamp.gradle.guide')
    id('org.ajoberstar.git-publish')
}

repositories {
    mavenLocal()
}

dependencies {
    testImplementation project(":underdog-dataframe")
    testImplementation project(":underdog-graphs")
    testImplementation project(":underdog-ml")
    testImplementation project(":underdog-plots")
    testImplementation project(":underdog-ta")
    testImplementation "org.spockframework:spock-core:$spock"
}

tasks.register("setAuthentication") {
    doLast {
        System.setProperty("org.ajoberstar.grgit.auth.username", findProperty('PUBLISH_GH_TOKEN').toString())
    }
}

gitPublishPush {
    dependsOn 'setAuthentication'
}

asciidoctor {
    baseDirFollowsSourceDir()
    attributes(
        'underdog': version,
        'github': '.',
        'toc': 'left',
        'toclevels'          : 4,
        'source-highlighter': 'rouge')
}

asciidoctorj {
    modules {
        diagram.version '2.1.0'
    }
}

test {
    useJUnitPlatform()
}