=== Getting started
:sources: ../../../../src/test/groovy/underdog/guide/ta

This getting started section mimics the getting started section steps from Ta4j wiki but using underdog-ta module. You can compare both entries to see the differences.

==== BarSeries vs DataFrame

It's important to start defining some concepts.

- BarSeries: Ta4j's BarSeries is like a dataframe containing series (columns) such as open price, lower price, close price, and volume data.

- DataFrame: Underdog's dataframe which is composed of different Series (columns), Each Series or column is like an array of objects.

As this module integrates Ta4j with Underdog there will be methods which converts from BarSeries to DataFrame and vice versa.

==== Loading data

In this example we are using Underdog to load stock quotes from a csv file and create a DataFrame:

[source, groovy]
.stock quotes from csv
----
include::{sources}/GettingStartedSpec.groovy[tag=loading_data, indent=0]
----

<1> The file path where the csv file can be found
<2> The format of the dates included in the file. This will help the csv reader to parse those dates and create instances of **java.time.LocalDate**.

IMPORTANT: If dates are not treated as dates the csv reader will consider them as strings. That will cause you problems when converting an Underdog's DataFrame to Ta4j's BarSeries.

Which outputs something like the following (the prices and volume are truncated here to make it look good).

[source, shell]
.output
----
                                stock_quotes_10_years.csv
           Date             |  Adj Close  |  Close |  High  |  Low  |  Open  |   Volume |
-----------------------------------------------------------------------------------------
 2014-12-05 00:00:00+00:00  |   0.50      |  0.52  |  0.52  |  0.52 |  0.52  |  165680  |
----

In order to successfully convert the dataframe to a bar series the name of the series (columns) should match to the expected ones which are: DATE, CLOSE, HIGH, LOW, OPEN, VOLUME.

[source, groovy]
.renaming
----
include::{sources}/GettingStartedSpec.groovy[tag=renaming_cols, indent=0]
----

<1> Removing the **Adj Close** column as it doesn't matches any of the bar series columns
<2> Renaming all remaining columns to upper case to match the expected column names in the bar series.

[source, shell]
.output
----
                          stock_quotes_10_years.csv
           DATE             |  CLOSE |  HIGH  |  LOW  |  OPEN  |  VOLUME  |
---------------------------------------------------------------------------
 2014-12-05 00:00:00+00:00  |  0.52  |  0.52  |  0.52 |  0.52  |  165680  |
----

==== DataFrame to BarSeries

Because we need to convert the dataframe to a BarSeries in order to create technical analysis rules:

[source, groovy]
.to bar series
----
include::{sources}/GettingStartedSpec.groovy[tag=convert_to_bar_series, indent=0]
----

Now we can operate with the bar series.

==== Indicators

Now we can start creating some indicators and metrics. This time we are getting metrics based on the closing price indicator:

[source, groovy]
.indicators
----
include::{sources}/GettingStartedSpec.groovy[tag=building_indicators,indent=0]
----

[source, shell]
.output
----
5-bars-SMA value at the 42nd index: 0.503899997472763
----

==== Building a trading strategy

Now that we've got a couple of indicators ready lets build a strategy. Strategies are made of two trading rules: one for entry (buying), the other for exit (selling).

[source,groovy]
.strategy base
----
include::{sources}/GettingStartedSpec.groovy[tag=strategy_base,indent=0]
----

We can use Groovy's syntax to refactor the rules a little bit:

[source,groovy]
.strategy using operators
----
include::{sources}/GettingStartedSpec.groovy[tag=strategy_or,indent=0]
----

In Groovy **|** and **&** represent calls to methods **or** and **and** of any object (any object having those methods implemented). So if your object has these methods, you can substitute your method call by the operators.

==== Backtesting

What is backtesting ? According to Investopedia:

"Backtesting is the general method for seeing how well a strategy or model would have done after the fact. It assesses the viability of a trading strategy by discovering how it would play out using historical data. If backtesting works, traders and analysts may have the confidence to employ it going forward"
-- Investopedia, https://www.investopedia.com/terms/b/backtesting.asp

The backtest step is pretty simple:

[source, groovy]
.backtesting
----
include::{sources}/GettingStartedSpec.groovy[tag=backtesting_base, indent=0]
----

[source, shell]
.output
----
Number of positions (trades) for our strategy: 57
----

For many scenarios we can run a base strategy backtesting by just executing the **run** method in the BarSeries object and pass directly the entry (buying) rule and the exit (selling) rule:

[source, groovy]
.backtesting
----
include::{sources}/GettingStartedSpec.groovy[tag=backtesting_extension, indent=0]
----

We can see this visually. Follow-up showing only trades from 2024-04-01:

[source, groovy]
.plotting trades
----
include::{sources}/GettingStartedSpec.groovy[tag=show_trades,indent=0]
----

image::ta/getting_started_trades.png[align=center]

We can also visualize winning vs losing positions.

[source, groovy]
.winning vs losing
----
include::{sources}/GettingStartedSpec.groovy[tag=show_positions,indent=0]
----

image::ta/getting_started_winners.png[align=center]

==== Analyzing our results

Here is how we can analyze the results of our backtest:

[source, groovy]
.analysis
----
include::{sources}/GettingStartedSpec.groovy[tag=analysis_base, indent=0]
----

[source, shell]
.output
----
Winning positions ratio: 0.54385964912280701754385964912281
Return over Max Drawdown: 3.4519153297405649777237484258582
Our return vs buy-and-hold return: 0.0040904249296843023287166775087440
----

Showing these metrics in a chart:

[source, groovy]
.radar
----
include::{sources}/GettingStartedSpec.groovy[tag=analysis_radar,indent=0]
----

Which displays:

image::ta/getting_started_radar.png[align=center, width="60%"]